import{a as w}from"./audioManager.NZJ33dCK.js";import"./_commonjsHelpers.C4iS2aBk.js";document.querySelectorAll(".delete-profile").forEach(a=>{a.addEventListener("click",async()=>{const e=a,t=e.dataset.profileId,s=parseInt(e.dataset.soundCount||"0");if(!t)return;const d=s>0?`This will delete the profile and ${s} associated sound${s!==1?"s":""}. Are you sure?`:"Are you sure you want to delete this profile?";if(confirm(d))try{e.disabled=!0,e.textContent="Deleting...";const o=await fetch(`/api/sound-profiles/${t}`,{method:"DELETE"});if(!o.ok){const l=await o.json();throw new Error(l.error||"Failed to delete profile")}const n=e.closest(".bg-white");if(!n)return;const i=n.querySelector(".download-all-button");if(!i)return;JSON.parse(i.dataset.sounds||"[]").forEach(async l=>{w.getCurrentSoundId()===l.file&&await w.pause()}),n instanceof HTMLElement&&(n.style.transition="opacity 0.3s ease-out",n.style.opacity="0",setTimeout(()=>{n.remove()},300))}catch(o){console.error("Profile deletion error:",o),alert(o instanceof Error?o.message:"Failed to delete profile"),e.disabled=!1,e.textContent="Delete Profile"}})});let u=!1;document.querySelectorAll(".download-all-button").forEach(a=>{a.addEventListener("click",async()=>{if(u)return;const e=a,t=JSON.parse(e.dataset.sounds||"[]"),s=e.dataset.profileTitle||"sounds",d=e.textContent||"Download All Sounds";if(t.length===0){alert("No sounds available to download");return}try{u=!0,e.disabled=!0;for(let o=0;o<t.length;o++){e.textContent=`Downloading ${o+1}/${t.length}`;const n=await fetch("/api/sounds/refresh-url",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({soundId:t[o].id})});if(!n.ok)throw new Error(`Failed to get download URL for ${t[o].name}`);const{url:i}=await n.json(),c=await fetch(i);if(!c.ok)throw new Error(`Failed to download ${t[o].name}`);const l=await c.blob(),f=window.URL.createObjectURL(l),r=document.createElement("a");r.style.display="none",r.href=f,r.download=`${s}-${t[o].name.toLowerCase().replace(/[^a-z0-9]/g,"-")}.mp3`,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(f),document.body.removeChild(r),await new Promise(p=>setTimeout(p,1e3))}e.textContent=d}catch(o){console.error("Download error:",o),alert("Failed to download some sounds. Please try again.")}finally{u=!1,e.disabled=!1,e.textContent=d}})});
