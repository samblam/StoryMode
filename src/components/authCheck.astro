---
---
<script>
    const setUser = async () => {
     const token = document.cookie.split('; ').find(row => row.startsWith('sb-token='))?.split('=')[1];
     if (!token) {
           const event = new CustomEvent('user', { detail: { user: null } });
           document.dispatchEvent(event);
           return;
         }
          try {
             const response = await fetch('/api/auth/test-token', {
                 method: 'POST',
                 headers: {
                     'Content-Type': 'application/json',
                 },
                 body: JSON.stringify({ token }),
             });
 
             if (response.ok) {
               const result = await response.json();
                 const event = new CustomEvent('user', { detail: { user: result.user } });
                 document.dispatchEvent(event);
                 return;
             }
         } catch (error) {
             console.error('Error checking session:', error);
         }
        const event = new CustomEvent('user', { detail: { user: null } });
       document.dispatchEvent(event);
     };
 
     setUser();
 
 </script>